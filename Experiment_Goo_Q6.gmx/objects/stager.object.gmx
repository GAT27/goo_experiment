<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>stager_set</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>100</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///SCENE SETUP

//Parameters
data = 10;
backscene = 0;
donce = 2;
g_ready = 0;
combo = 0;
dombo = 0;
raw = 0;
output = 0;
dotal = 0;
hstun = 0;
wall_l = instance_create(0,0,groundf);
wall_r = instance_create(0,0,groundf);
xxb = 0;
//yyb = 1;
//rot = 0;
target_x = 0;
target_y = 0;
target_z = 0;
clock_s = 0;
//globalvar player_one;
//globalvar player_two;
surf0 = -1;
debugg = 0;
//lag_scr = 0;
//application_surface_enable(false);

// initialize 3D
d3d_start();
d3d_set_hidden(true);
//d3d_set_lighting(false);
//d3d_set_culling(true);
d3d_set_lighting(true);
d3d_light_define_direction(1, 0, -1, -1, c_white);
d3d_light_define_direction(2, 0, 1, -1, c_white);
d3d_light_enable(1, true);
d3d_light_enable(2, true);
//d3d_set_culling(true);
// interpolate textures
texture_set_interpolation(true);

scr_create_animation_vertex_format();
global.shader_interpol = shader_get_uniform(sh_blend, "u_interpol");
//make it global, so that the "scr_draw_animation_frame" script
//can call it from anywhere in the project

//Camera controls
zview = -10;
mouse_direction = 90;
//h = 20;
xup = 0;
yup = -1;
zup = 0;
dist = 1000;

/*
//3D setup
draw_set_color(c_gray);
d3d_start();
//d3d_set_culling(true);
d3d_set_culling(false);
//d3d_set_lighting(true);
/*d3d_set_lighting(false);
d3d_light_define_direction(1, 0, -1, -1, c_white);
d3d_light_define_direction(2, 0, 1, -1, c_white);
d3d_light_enable(1, true);
d3d_light_enable(2, true);*//*

//Camera controls
ct = 0;
htemp = 0;

xf = 0;
yf = -80;
zf = 800;

xt = 0;
yt = -150;
zt = 200;

xu = 0;
yu = -1;
zu = 1;

ag = 35;
zn = 1;
zd = 1000;*/

//d3d_transform_set_identity();
//d3d_set_projection_ext(0,0,4,0,0,-5,0,0,1,ag,4/3,zn,zd);
//d3d_set_projection_ext(0,10,0,5,0,5,0,0,1,ag,4/3,zn,zd);
//d3d_set_projection_ext(0,0,0,0,0,10,0,0,1,ag,4/3,zn,zd);
//d3d_set_projection_ext(xf,yf,zf,xt,yt,zt,xu,yu,zu,ag,4/3,zn,zd);

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///CLOCK

clock_s--;
player_one.tick = 1;
player_two.tick = 1;
alarm[0] = room_speed;

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="1">
      <action>
        <libid>1</libid>
        <id>612</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>-1</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>1</exetype>
        <functionname>action_if_variable</functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>0</kind>
            <string>g_ready</string>
          </argument>
          <argument>
            <kind>0</kind>
            <string>1</string>
          </argument>
          <argument>
            <kind>4</kind>
            <string>0</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///ACTIVATION

if donce == 2//Initial selection
{
    //Characters
    data = data1;
    globalvar player_one;
    globalvar player_two;
    repeat 2 
    {
        //Colors based on "http://colorizer.org/"
        switch data&amp;127
        {
            case 1:     //sprite_assign(block_tmp,block_red);
                        data = power_one;
                        cH = 0; cS = 100; cV = 85;
                        break;
            case 2:     //sprite_assign(block_tmp,block_red);
                        data = power_one;
                        cH = 240; cS = 100; cV = 80;
                        break;
            case 3:     //sprite_assign(block_tmp,block_red);
                        data = power_one;
                        cH = 60; cS = 100; cV = 90;
                        break;
            case 4:     //sprite_assign(block_tmp,block_red);
                        data = power_one;
                        cH = 130; cS = 100; cV = 45;
                        break;
            case 5:     //sprite_assign(block_tmp,block_red);
                        data = power_one;
                        cH = 320; cS = 100; cV = 65;
                        break;
            case 6:     //sprite_assign(block_tmp,block_red);
                        data = power_one;
                        cH = 170; cS = 100; cV = 90;
                        break;
            case 7:     //sprite_assign(block_tmp,block_red);
                        data = power_one;
                        cH = 0; cS = 0; cV = 70;
                        break;
            /*
            default:    sprite_assign(block_tmp,block_blue);
                        player_one = instance_create(256,1008,power_one);
                        instance_create(196,224,power_one);
                        break;*/
        }
        if donce==2
        {
            color_one = make_color_hsv(round(cH*255/360),
                                       round(cS*255/100),
                                       round(cV*255/100));
            player_one = instance_create(32*25,1023,data);
            
            data = data2;
            donce--;
        }
        else
        {
            color_two = color_one;
            color_one = make_color_hsv(round(cH*255/360),
                                       round(cS*255/100),
                                       round(cV*255/100));
            player_two = instance_create(32*41,1023,data);
            data = color_one;
            color_one = color_two;
            color_two = data;
            
            player_one.oppose = player_two;
            player_one.tick = 0;
            player_one.raw = 0;
            player_one.output = 0;
            player_one.dotal = 0;
            player_one.dombo = 0;
            player_two.oppose = player_one;
            player_two.tick = 0;
            player_two.raw = 0;
            player_two.output = 0;
            player_two.dotal = 0;
            player_two.dombo = 0;
        }
    }
    
    //Stages
    switch data3&amp;127
    {
        case 0:     //background_assign(back_tmp,back_yellow);
                    backscene = 0;
                    break;
        case 1:     //background_assign(back_tmp,back_green);
                    backscene = 1;
                    break;
    }
    
    //Clock
    data3 = data3&gt;&gt;7;
    clock_s = (data3&amp;15) * 300;
    data = 10;
    alarm[0] = 1;
    donce--;
}

else if donce//Move again after pause or lag
{
    instance_activate_object(player_one);
    instance_activate_object(player_two);
    donce--;
}

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///STAGER

//Game is in motion
if g_ready
{
    //Check for end, otherwise, send player data
    if data&amp;1 or (data&gt;&gt;10)&amp;1 or clock_s&lt;0
    {
        file_text_close(file);
        d3d_end();
        d3d_set_lighting(false);
        ds_list_destroy(player_one.abox);
        ds_list_destroy(player_two.abox);
        if puppeteer.online
        {
            network_destroy(puppeteer.peer);
            buffer_delete(puppeteer.buffer_pak);
            //ds_queue_clear(puppeteer.data_t);
            ds_queue_destroy(puppeteer.data_t);
        }
        room_goto(stage_room);
    }
    player_one.data = (data&gt;&gt;1)&amp;511;
    player_two.data = (data&gt;&gt;11)&amp;511;
    
    //Combo and damage calculation
    if (player_one.combo&gt;combo) or (player_two.combo&gt;combo)
    {
        if player_one.combo==1
        {
            P = player_one;
            O = player_two;
            tot = 0;
            hstun = 0;
            dotal = 0;
            for(var i=64;i&lt;=184;i+=8)
                tot += P.action[i,4];
            decay = ds_queue_create();
        }
        else if player_two.combo==1
        {
            P = player_two;
            O = player_one;
            tot = 0;
            hstun = 0;
            dotal = 0;
            for(var i=64;i&lt;=184;i+=8)
                tot += P.action[i,4];
            decay = ds_queue_create();
        }
        
        st4 = O.htate - (O.htate % 8);
        fresh = tot / (tot + P.action[st4,4] - 1);
        if O.sty==0
        {
            if !(O.htate%8) and !(O.htate&gt;=192)
                ds_queue_enqueue(decay,st4);
            hstun++;
            O.buffer_mtr -= P.damage[O.htate,1]
                          - ((hstun - (hstun%2))
                          * (100 - ((10-O.speed_sec)*6)) / 200);
            brek = 0;
        }
        else
        {
            O.buffer_mtr -= P.blocks[O.htate,1]
                          * (100 - (O.defense_sec*6)) / 100;
            brek = P.damage[O.htate,0] * fresh * (1 + P.charge/(P.stock*20))
                 * P.blocks[O.htate,0];
        }
        if O.htate&gt;=192
            O.sty *= 0.9;
        
        raw = P.damage[O.htate,0] * fresh * (1 + P.charge/(P.stock*20));
        output = ceil(brek * (1-O.defense_pri/50) * O.sty);
        O.shield -= output;
        output = ceil(raw * (1-O.defense_pri/50) * (1-O.sty));
        
        dotal += output;
        O.life -= output;
        O.will -= output;
        P.will += output;
        P.bar += output * (60 + P.stamina_sec*8) / 100;
        
        P.charge = 0;
        combo++;
        dombo = combo;
    }
    if combo and (O.buffer_mtr&gt;59 or O.sty&gt;0)
    {
        while !ds_queue_empty(decay)
        {
            tot = ds_queue_dequeue(decay);
            P.action[tot,4] += 10 - P.power_pri;
        }
        ds_queue_destroy(decay);
        //P.combo = 0;
        combo = 0;
        //dotal = 0;
        hstun = 0;
    }
    
    //Player distance room
    center_sp = (player_one.x + player_two.x) / 2;
    wall_l.x = center_sp - 17*32;
    wall_r.x = center_sp + 16*32;
    with wall_l
    if distance_to_object(player_one) &lt; distance_to_object(player_two)
        y = player_one.y - 64;
    else
        y = player_two.y - 64;
    with wall_r
    if distance_to_object(player_one) &lt; distance_to_object(player_two)
        y = player_one.y - 64;
    else
        y = player_two.y - 64;
}

//Prepare to pause game
else if !donce
    donce++;

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="64">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///HUD

d3d_set_lighting(false);
    
hud_w = display_get_gui_width();
hud_h = display_get_gui_height();
hud_s = min(hud_w,hud_h) * 0.8;
if surface_get_width(application_surface) != hud_w
or surface_get_height(application_surface) != hud_h
{
    surface_resize(application_surface,hud_w,hud_h);
    if surface_exists(surf0)
    {
        surface_resize(surf0,hud_w,hud_h);
        surface_copy(surf0,0,0,application_surface);
    }
}
    
draw_set_font(HUD_test);

//Realtime display
if g_ready
{
    //Calc and setup for display
    if surface_exists(surf0)
    {
        surface_free(surf0);
        surf0 = -1;
    }
    ////
    if !player_one.goo
        var rot_b1 = 90;
    else
        var rot_b1 = 90 * (540-260-40*player_one.goo) / 540;
    var ellx_b1 = hud_s * (1-dsin(rot_b1)) / 2;
    var elly_b1 = hud_s * (1-dcos(rot_b1)) / 2;
    var rot_g1 = 90 * (540-player_one.bar) / 540;
    var ellx_g1 = hud_s * (1-dsin(rot_g1)) / 2;
    var elly_g1 = hud_s * (1-dcos(rot_g1)) / 2;
    var rot_c1 = 90 * (540-300-40*player_one.goo) / 540;
    var ellx_c1 = hud_s * (1-dsin(rot_c1)) / 2;
    var elly_c1 = hud_s * (1-dcos(rot_c1)) / 2;
    ////
    if !player_two.goo
        var rot_b2 = -90;
    else
        var rot_b2 = 90 * (260+40*player_two.goo-540) / 540;
    var ellx_b2 = hud_s * (1-dsin(rot_b2)) / 2;
    var elly_b2 = hud_s * (1-dcos(rot_b2)) / 2;
    var rot_g2 = 90 * (player_two.bar-540) / 540;
    var ellx_g2 = hud_s * (1-dsin(rot_g2)) / 2;
    var elly_g2 = hud_s * (1-dcos(rot_g2)) / 2;
    var rot_c2 = 90 * (300+40*player_two.goo-540) / 540;
    var ellx_c2 = hud_s * (1-dsin(rot_c2)) / 2;
    var elly_c2 = hud_s * (1-dcos(rot_c2)) / 2;
    ////
    var rot_r = -40;
    //xxb++;
    var scl_r = 0.25;
    //var ellx_r = hud_s * (1-dsin(rot_r) + dsin(rot_r)*(1-scl_r)) / 2;
    var ellx_r = hud_s * (1-dsin(rot_r)*scl_r) / 2;
    var elly_r = hud_s * (1-dcos(rot_r)*scl_r) / 2;
    var rot_h1 = 180 * ((player_one.charge/20/player_one.stock) - 1);
    var ellx_h1 = hud_s * (1-dsin(rot_h1)) / 2;
    var elly_h1 = hud_s * (1-dcos(rot_h1)) / 2;
    var rot_h2 = 180 * ((player_two.charge/20/player_two.stock) - 1);
    var ellx_h2 = hud_s * (1-dsin(rot_h2)) / 2;
    var elly_h2 = hud_s * (1-dcos(rot_h2)) / 2;
    ////
    var rot_w = 90 * (1 - (player_one.will/2000));
    var ellx_w = hud_s * (1-dsin(rot_w)) / 2;
    var elly_w = hud_s * (1-dcos(rot_w)) / 2;
    var rot_s1 = 90 * (1 - (player_one.shield/2000));
    var ellx_s1 = hud_s * (1-dsin(rot_s1)) / 2;
    var elly_s1 = hud_s * (1-dcos(rot_s1)) / 2;
    var rot_s2 = 90 * ((player_two.shield/2000) - 1);
    var ellx_s2 = hud_s * (1-dsin(rot_s2)) / 2;
    var elly_s2 = hud_s * (1-dcos(rot_s2)) / 2;
    ////
    var plah = 0.9;
    var plav = 0.1;
    draw_set_circle_precision(48);
    surf1 = surface_create(hud_s,hud_s);
    surf2 = surface_create(hud_s,hud_s);
    surf3 = surface_create(hud_s,hud_s);
    surface_set_target(surf1);
    draw_clear_alpha(c_black,0);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    
    //Player 1 goo
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      merge_color(c_lime,0,(player_one.goo-1)/10),
                      merge_color(c_lime,0,(player_one.goo-1)/10),false);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s/2,
                         ellx_b1,elly_b1,-1,1,rot_b1,-1,-1,-1,-1,1);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    ////
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      merge_color(c_lime,0,player_one.goo/10),
                      merge_color(c_lime,0,player_one.goo/10),false);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s/2,
                         ellx_g1,elly_g1,-1,1,rot_g1,-1,-1,-1,-1,1);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    ////
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      make_color_hsv(16+32*player_one.goo,192,96),
                      make_color_hsv(64+32*player_one.goo,192,96),false);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s/2,
                         ellx_c1,elly_c1,1,1,rot_c1,-1,-1,-1,-1,1);
    ////
    draw_set_blend_mode(bm_subtract);
    //draw_ellipse(0,hud_s*0.35,hud_s,hud_s*0.75,false);
    draw_circle(hud_s/2,hud_s*0.75,hud_s/2,false);
    draw_set_blend_mode(bm_normal);
    surface_reset_target();
    draw_surface_part_ext(surf1,0,0,hud_s/2,hud_s/2,
                          (1-plah)*hud_w/2,
                          (plav-0.02)*hud_h,
                          (plah+0.1)*0.35*2*hud_w/hud_s,
                          0.14*2*hud_h/hud_s,
                          -1,1);
    surface_set_target(surf1);
    draw_clear_alpha(c_black,0);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    
    //Player 2 goo
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      merge_color(c_lime,0,(player_two.goo-1)/10),
                      merge_color(c_lime,0,(player_two.goo-1)/10),false);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s/2,
                         ellx_b2,elly_b2,1,1,rot_b2,-1,-1,-1,-1,1);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    ////
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      merge_color(c_lime,0,player_two.goo/10),
                      merge_color(c_lime,0,player_two.goo/10),false);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s/2,
                         ellx_g2,elly_g2,1,1,rot_g2,-1,-1,-1,-1,1);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    ////
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      make_color_hsv(16+32*player_two.goo,192,96),
                      make_color_hsv(64+32*player_two.goo,192,96),false);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s/2,
                         ellx_c2,elly_c2,-1,1,rot_c2,-1,-1,-1,-1,1);
    ////
    draw_set_blend_mode(bm_subtract);
    //draw_ellipse_color(0,hud_s*0.35,hud_s,hud_s*0.75,-1,-1,false);
    draw_circle(hud_s/2,hud_s*0.75,hud_s/2,false);
    draw_set_blend_mode(bm_normal);
    surface_reset_target();
    draw_surface_part_ext(surf1,hud_s/2,0,hud_s/2,hud_s/2,
                          (plah-1)*hud_w/2 - (plah+0.1)*0.35*hud_w + hud_w,
                          (plav-0.02)*hud_h,
                          (plah+0.1)*0.35*2*hud_w/hud_s,
                          0.14*2*hud_h/hud_s,
                          -1,1);
    surface_set_target(surf1);
    draw_clear_alpha(c_black,0);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    surface_set_target(surf3);
    draw_clear_alpha(c_black,0);
    
    //Player 1 stock and charge
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      c_red,c_red,false);
    surface_reset_target();
    draw_surface_general(surf3,hud_s/2,0,hud_s/2,hud_s,
                         ellx_h1,elly_h1,1,1,rot_h1,-1,-1,-1,-1,1);
    surface_copy(surf3,0,0,surf2);
    draw_surface_ext(surf3,0,0,1,1,0,-1,0.8);
    surface_set_target(surf3);
    draw_clear_alpha(c_black,0);
    ////
    for(var i=0;i&lt;player_one.stock;i++)
        draw_circle_color(hud_s/2 + hud_s*(0.5+0.4)/2*dsin((10+20*i) * 180/20/player_one.stock),
                          hud_s/2 + hud_s*(0.5+0.4)/2*dcos((10+20*i) * 180/20/player_one.stock),
                          hud_s*(0.5-0.4)/2,
                          color_one,color_one,false);
    surface_reset_target();
    draw_surface(surf3,0,0);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s,
                         ellx_r,elly_r,scl_r,scl_r,rot_r,-1,-1,-1,-1,1);
    ////
    draw_set_blend_mode(bm_subtract);
    draw_circle(hud_s/2,hud_s/2,hud_s*scl_r*0.4,false);
    draw_set_blend_mode(bm_normal);
    surface_reset_target();
    draw_set_halign(fa_right);
    line = "    " + string(player_one.life);
    for(i=5;i&gt;0;i--)
    {
        var rot_l = rot_r + (5.5-i)*180/5;
        //var ellx_l = hud_s*(1-dsin(rot_l) + dsin(rot_l)*(1-1*scl_r*1.3))/2 + ((1-plah*0.9)*hud_w-hud_s)/2;
        var ellx_l = (hud_s*(1-dsin(rot_l)*scl_r*1.3) + (1-plah*0.9)*hud_w-hud_s)/2;
        var elly_l = hud_s*(1-dcos(rot_l)*scl_r*1.3)/2 + (-0.15+plav)*hud_h;
        draw_text_transformed_color(ellx_l,// ellx_r + /*1.02*/((1-plah*0.95)*hud_w-hud_s)/2 + /*(5-i)*/hud_s*scl_r*1.5 * (1-dsin(rot_l1)) / 2,
                                    elly_l,// elly_r + /*1.22*/(-0.2+plav)*hud_h + /*(5-i)*/hud_s*scl_r*1.5 * (1-dcos(rot_l1)) / 2,
                                    string_char_at(line,string_length(string(player_one.life))+i-1),
                                    hud_w/view_wview[0],
                                    hud_h/view_hview[0],
                                    rot_l,0,0,0,0,1);
    }
    draw_set_halign(fa_left);
    draw_surface_ext(surf1,
                     ((1-plah*0.9)*hud_w-hud_s)/2,
                     (-0.15+plav)*hud_h,
                     1,1,0,-1,1);
    //draw_surface(surf1,0,0);
    surface_set_target(surf1);
    draw_clear_alpha(c_black,0);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    surface_set_target(surf3);
    draw_clear_alpha(c_black,0);
    
    //Player 2 stock and charge
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      c_red,c_red,false);
    surface_reset_target();
    draw_surface_general(surf3,hud_s/2,0,hud_s/2,hud_s,
                         ellx_h2,elly_h2,1,1,rot_h2,-1,-1,-1,-1,1);
    surface_copy(surf3,0,0,surf2);
    draw_surface_ext(surf3,0,0,1,1,0,-1,0.8);
    surface_set_target(surf3);
    draw_clear_alpha(c_black,0);
    ////
    for(i=0;i&lt;player_two.stock;i++)
        draw_circle_color(hud_s/2 + hud_s*(0.5+0.4)/2*dsin((10+20*i) * 180/20/player_two.stock),
                          hud_s/2 + hud_s*(0.5+0.4)/2*dcos((10+20*i) * 180/20/player_two.stock),
                          hud_s*(0.5-0.4)/2,
                          color_two,color_two,false);
    surface_reset_target();
    draw_surface(surf3,0,0);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s,
                         ellx_r,elly_r,scl_r,scl_r,rot_r,-1,-1,-1,-1,1);
    ////
    draw_set_blend_mode(bm_subtract);
    draw_circle(hud_s/2,hud_s/2,hud_s*scl_r*0.4,false);
    draw_set_blend_mode(bm_normal);
    surface_reset_target();
    draw_set_halign(fa_right);
    line = string(player_two.life) + "    ";
    for(i=1;i&lt;=5;i++)
    {
        rot_l = -(rot_r + (i-0.5)*180/5);
        ellx_l = (hud_s*(1-dsin(rot_l)*scl_r*1.3) + (1+plah*0.9)*hud_w-hud_s)/2;
        elly_l = hud_s*(1-dcos(rot_l)*scl_r*1.3)/2 + (-0.15+plav)*hud_h;
        draw_text_transformed_color(ellx_l,elly_l,
                                    string_char_at(line,i),
                                    hud_w/view_wview[0],
                                    hud_h/view_hview[0],
                                    rot_l,0,0,0,0,1);
    }
    draw_set_halign(fa_left);
    draw_surface_ext(surf1,
                     ((1+plah*0.9)*hud_w+hud_s)/2,
                     (-0.15+plav)*hud_h,
                     -1,1,0,-1,1);
    surface_set_target(surf1);
    draw_clear_alpha(c_black,0);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    
    //Player 1 will and shield
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      c_maroon,c_maroon,false);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s,
                         ellx_w,elly_w-hud_h*0.02,-1,1,rot_w,-1,-1,-1,-1,1);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    ////
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      color_one,color_one,false);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s,
                         ellx_w,elly_w,-1,1,rot_w,-1,-1,-1,-1,1);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    ////
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      c_maroon,c_maroon,false);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s,
                         ellx_s1,elly_s1,-1,1,rot_s1,-1,-1,-1,-1,1);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    
    //Player 2 will and shield
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      c_navy,c_navy,false);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s,
                         ellx_w,elly_w-hud_h*0.02,1,1,rot_w,-1,-1,-1,-1,1);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    ////
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      color_two,color_two,false);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s,
                         ellx_w,elly_w,1,1,rot_w,-1,-1,-1,-1,1);
    surface_set_target(surf2);
    draw_clear_alpha(c_black,0);
    ////
    draw_circle_color(hud_s/2,hud_s/2,hud_s/2,
                      c_navy,c_navy,false);
    surface_reset_target();
    draw_surface_general(surf2,hud_s/2,0,hud_s/2,hud_s,
                         ellx_s2,elly_s2,1,1,rot_s2,-1,-1,-1,-1,1);
    
    //End and clean top display
    draw_set_blend_mode(bm_subtract);
    draw_circle(hud_s/2,hud_s*0.6,hud_s/2,false);
    draw_set_blend_mode(bm_normal);
    surface_reset_target();
    draw_surface_stretched(surf1,
                           (1-plah)*hud_w/2,
                           (plav-0.05)*hud_h,
                           plah*hud_w,
                           hud_h*0.3);
    surface_free(surf3);
    surface_free(surf2);
    surface_free(surf1);
    
    //Setup debug display
    if player_one.combo
    {
        player_one.raw = raw;
        player_one.output = output;
        player_one.dotal = dotal;
        player_one.dombo = dombo;
        player_two.raw = 0;
        player_two.output = 0;
        player_two.dotal = 0;
        player_two.dombo = 0;
    }
    else if player_two.combo
    {
        player_one.raw = 0;
        player_one.output = 0;
        player_one.dotal = 0;
        player_one.dombo = 0;
        player_two.raw = raw;
        player_two.output = output;
        player_two.dotal = dotal;
        player_two.dombo = dombo;
    }
    if !combo and dombo
    {
        player_one.combo = 0;
        player_two.combo = 0;
        dombo = 0;
    }
    
    //Show debug
    if debugg
    {
        //Player 1 decay stats
        for(i=0;i&lt;16;i++)
        {
            switch i%8
            {
                case 0: line = 'still: '; break;
                case 1: line = 'tilt:  '; break;
                case 2: line = 'rush:  '; break;
                case 3: line = 'down:  '; break;
                case 4: line = 'up:    '; break;
                case 5: line = 'nair:  '; break;
                case 6: line = 'fair:  '; break;
                case 7: line = 'dair:  '; break;
            }
            if i&lt;8
                line += string(player_one.action[64+i*16,4]);
            else
                line += string(player_one.action[72+(i-8)*16,4]);
            draw_text_transformed_color(0,hud_h*(0.3+0.02*i),
                                        line,
                                        0.3*hud_w/view_wview[0],
                                        0.3*hud_h/view_hview[0],
                                        0,lerp(c_navy,c_maroon,(i-i%8)/8),lerp(c_navy,c_maroon,(i-i%8)/8),
                                        lerp(c_navy,c_maroon,(i-i%8)/8),lerp(c_navy,c_maroon,(i-i%8)/8),1);
        }
        
        //Player 1 debug
        for(i=0;i&lt;10;i++)
        {
            switch i
            {
                case 0: line = 'Raw: ' + string(player_one.raw); break;
                case 1: line = 'Output: ' + string(player_one.output); break;
                case 2: line = 'Total: ' + string(player_one.dotal); break;
                case 3: line = 'Ground: ' + string(player_one.grounded); break;
                case 4: line = 'Ping: ' + string(puppeteer.ping_avr); break;
                
                case 5: line = 'State: ' + string(player_one.state); break;
                case 6: line = 'Buffer: ' + string(player_one.buffer_mtr); break;
                case 7: line = 'Combo: ' + string(player_one.dombo); break;
                case 8: line = 'Gravity: ' + string(player_one.gvy); break;
                case 9: line = '1000ms: ' + string(puppeteer.ping_m); break;
            }
            draw_text_transformed_color(hud_w*(0.10+0.12*(i-i%5)/5),
                                        hud_h*(0.30+0.03*(i%5)),
                                        line,
                                        0.4*hud_w/view_wview[0],
                                        0.4*hud_h/view_hview[0],
                                        0,c_fuchsia,c_fuchsia,c_fuchsia,c_fuchsia,1);
        }
        
        //Player 2 debug
        for(i=0;i&lt;10;i++)
        {
            switch i
            {
                case 0: line = 'Raw: ' + string(player_two.raw); break;
                case 1: line = 'Output: ' + string(player_two.output); break;
                case 2: line = 'Total: ' + string(player_two.dotal); break;
                case 3: line = 'Ground: ' + string(player_two.grounded); break;
                case 4: line = 'Ping: ' + string(puppeteer.ping_avr); break;
                
                case 5: line = 'State: ' + string(player_two.state); break;
                case 6: line = 'Buffer: ' + string(player_two.buffer_mtr); break;
                case 7: line = 'Combo: ' + string(player_two.dombo); break;
                case 8: line = 'Gravity: ' + string(player_two.gvy); break;
                case 9: line = '1000ms: ' + string(puppeteer.ping_m); break;
            }
            draw_text_transformed_color(hud_w*(0.68+0.12*(i-i%5)/5),
                                        hud_h*(0.30+0.03*(i%5)),
                                        line,
                                        0.4*hud_w/view_wview[0],
                                        0.4*hud_h/view_hview[0],
                                        0,c_fuchsia,c_fuchsia,c_fuchsia,c_fuchsia,1);
        }
    }
    
    /*
    draw_primitive_begin(pr_trianglelist);
     draw_vertex_colour(100, 100, c_blue, 0.1);
     draw_vertex_colour(100, 200, c_red, 0.1);
     draw_vertex_colour(150, 150, c_green, 1);
     draw_primitive_end();
    
    //Player 1 stock and charge
    d3d_primitive_begin(pr_trianglestrip);
    d3d_vertex_color(hud_w*0.15,
                     hud_h*0.85,
                     0,c_red,0.2);
    d3d_vertex_color(hud_w*0.20,
                     hud_h*0.90,
                     0,c_red,0.2);
    d3d_vertex_color(hud_w*0.15 + hud_w*0.06*player_one.stock,
                     hud_h*0.85,
                     0,c_red,0.2);
    d3d_vertex_color(hud_w*0.20 + hud_w*0.06*player_one.stock,
                     hud_h*0.90,
                     0,c_red,0.2);
    d3d_primitive_end();
    ////
    d3d_primitive_begin(pr_trianglestrip);
    d3d_vertex_color(hud_w*0.15,
                     hud_h*0.85,
                     0,c_red,1);
    d3d_vertex_color(hud_w*0.20,
                     hud_h*0.90,
                     0,c_red,1);
    d3d_vertex_color(hud_w*0.15 + hud_w*0.06*player_one.charge/20,
                     hud_h*0.85,
                     0,c_red,1);
    d3d_vertex_color(hud_w*0.20 + hud_w*0.06*player_one.charge/20,
                     hud_h*0.90,
                     0,c_red,1);
    d3d_primitive_end();
    
    //Player 2 stock and charge
    d3d_primitive_begin(pr_trianglestrip);
    d3d_vertex_color(hud_w*0.80 - hud_w*0.06*player_two.stock,
                     hud_h*0.90,
                     0,c_red,0.2);
    d3d_vertex_color(hud_w*0.85 - hud_w*0.06*player_two.stock,
                     hud_h*0.85,
                     0,c_red,0.2);
    d3d_vertex_color(hud_w*0.80,
                     hud_h*0.90,
                     0,c_red,0.2);
    d3d_vertex_color(hud_w*0.85,
                     hud_h*0.85,
                     0,c_red,0.2);
    d3d_primitive_end();
    ////
    d3d_primitive_begin(pr_trianglestrip);
    d3d_vertex_color(hud_w*0.80 - hud_w*0.06*player_two.charge/20,
                     hud_h*0.90,
                     0,c_red,1);
    d3d_vertex_color(hud_w*0.85 - hud_w*0.06*player_two.charge/20,
                     hud_h*0.85,
                     0,c_red,1);
    d3d_vertex_color(hud_w*0.80,
                     hud_h*0.90,
                     0,c_red,1);
    d3d_vertex_color(hud_w*0.85,
                     hud_h*0.85,
                     0,c_red,1);
    d3d_primitive_end();
    
    /*
    draw_rectangle_color(hud_x + hud_w*0.15, hud_y + hud_h*0.8,
                         hud_x + hud_w*0.15 + hud_w*0.05*player_one.charge/20,
                         hud_y + hud_h*0.9,c_red,c_red,c_red,c_red,false);*/
    
    //d3d_start();
    
    //draw_text(hud_x, hud_y + hud_h*0.2, string(player_one.stamina));
    
    //draw_text(hud_x,hud_y + hud_h*0.02,data);
    //draw_text(hud_x,hud_y + hud_h*0.12,"stuff");
    //draw_text(hud_x,hud_y + hud_h*0.22,hud_x);
    //draw_text(hud_x,hud_y + hud_h*0.32,hud_y);
    //draw_text(hud_x,hud_y + hud_h*0.42,hud_w);
    //draw_text(hud_x,hud_y + hud_h*0.52,hud_h);
    //draw_text(hud_x,hud_y + hud_h*0.62,string(window_get_width())
    // +"-"+ string(view_wview[0]) +"="+ string(window_get_width() - view_wview[0]));
    //draw_text(hud_x,hud_y + hud_h*0.62,string(window_get_width())
    // +"-"+ string(view_wview[0]) +"="+ string(window_get_width() - view_wview[0]));
    //draw_text(hud_x,hud_y + hud_h*0.72,window_get_height() - view_hview[0]);
    
    //draw_set_color(c_gray);
    
    
    
    //d3d_set_lighting(true);
}

//Frozen display
else
{
    if surface_exists(surf0)
        draw_surface(surf0,0,0);
    else
    {
        surf0 = surface_create(hud_w,hud_h);
        surface_copy(surf0,0,0,application_surface);
        draw_surface(surf0,0,0);
        instance_deactivate_object(player_one);
        instance_deactivate_object(player_two);
    }
}

//Timer
draw_set_halign(fa_right);
draw_set_valign(fa_bottom);
draw_text_transformed_color(hud_w*0.5, hud_h,
                            string(clock_s)+".",
                            hud_w/view_wview[0],
                            hud_h/view_hview[0],
                            0,c_fuchsia,c_fuchsia,c_fuchsia,c_fuchsia,1);
draw_set_halign(fa_left);
draw_text_transformed_color(hud_w*0.5, hud_h*0.99,
                            string(alarm[0]),
                            0.5*hud_w/view_wview[0],
                            0.5*hud_h/view_hview[0],
                            0,c_fuchsia,c_fuchsia,c_fuchsia,c_fuchsia,1);
draw_set_valign(fa_top);

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///CAMERA

//d3d_transform_set_identity();
//d3d_transform_set_translation(0,0,-10);
//d3d_set_projection(xf,yf,zf,player_one.x,player_one.y,zt,xu,yu,zu);
//d3d_set_lighting(false);
//d3d_set_projection_perspective(0, 0, 640, 480, 60);
//d3d_set_projection_ext(0,0,0,0,0,1,0,0,1,ag,4/3,zn,zd);
//d3d_set_projection_ext(182+xf,383+yf,328+zf,10+xt,160+yt,-648+zt,xu,yu,zu,ag,4/3,0.1,10000);
//d3d_set_lighting(true);
//d3d_set_projection_ext(xf,yf,zf,xt,yt,zt,xu,yu,zu,ag,4/3,zn,zd);
//d3d_set_projection_ext(xf,yf,zf,xt,yt,zt,0,0,1,ag,4/3,zn,zd);
//182,383,328,10,160,-648
//d3d_transform_set_identity();
//d3d_light_define_direction(1, xf, yf, zf, c_white);
//d3d_set_projection_ext(0,10,0,5,0,5,0,0,1,ag,4/3,zn,zd);

/*switch backscene
{
    case 0:     //background_assign(back_tmp,back_yellow);
                draw_set_color(c_green);
                break;
    case 1:     //background_assign(back_tmp,back_green);
                draw_set_color(c_yellow);
                break;
}*/
draw_set_color(c_green);

//draw_set_alpha(1);
//draw_set_color(c_white);

//Camera controls
if gamepad_is_connected(0)
{
    if (abs(point_distance(0,0,gamepad_axis_value(0, gp_axisrh),
            gamepad_axis_value(0, gp_axisrv))) &gt; 0.2)
    {   
        mouse_direction += gamepad_axis_value(0, gp_axisrh) * 3;
        zview += gamepad_axis_value(0, gp_axisrv) * 3;
    }
    dist += gamepad_button_value(0, gp_shoulderlb) * 2.5;
    dist += -gamepad_button_value(0, gp_shoulderrb) * 2.5;
}
cc = cos(zview*pi/180);
cx = cos(mouse_direction*pi/180)*cc;
cy = sin(zview*pi/180);
cz = sin(mouse_direction*pi/180)*cc;

if g_ready
{
    target_x = (player_one.x + player_two.x) / 2;
    target_y = (player_one.y + player_two.y) / 2;
    target_z = (player_one.z + player_two.z) / 2;
}
hc = 050;
ht = 150;

d3d_set_projection(target_x+(cx*dist),target_y+(cy*dist)-hc,target_z+(cz*dist),
                   target_x,target_y-ht,target_z,xup,yup,zup);

/*
d3d_set_projection_ext(player_one.x+xf,player_one.y+yf,zf,
                       player_one.x+xt,player_one.y+yt,zt,
                       xu,yu,zu,
                       ag,16/9,zn,zd);*/
/*
var xto,yto,zto,dir,zdir;
xto = 0; //What are you looking at?
yto = 100;
zto = 0;
dir = direction; // The rotation around the xy plane
zdir = 70;// The z rotation
dist = 10;// The distance from the camera to the point
d3d_set_projection( xto+cos(dir*pi/180)*cos(zdir*pi/180)*dist,
yto-sin(dir*pi/180)*cos(zdir*pi/180)*dist, zto+sin(zdir*pi/180), xto, yto, zto, 0, 0, 1);
direction+=1;
d3d_draw_floor(0,0,0,1000,1000,0,-1,0,0);*/
////d3d_draw_floor(0, 0, 0, room_width, 0, room_height, -1, 0, 0);
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints>
    <point>0,0</point>
    <point>32,32</point>
  </PhysicsShapePoints>
</object>
